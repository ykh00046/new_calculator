<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>사출계획 약품/잉크 종류 계산기</title>
    
    <!-- 외부 라이브러리 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <!-- 헤더 -->
        <div class="header">
            <h1>🧪 사출계획 약품/잉크 종류 계산기</h1>
            <p>사출계획과 BOM 파일을 업로드하여 일자별 필요한 약품/잉크 종류를 확인하세요</p>
        </div>
        
        <!-- 업로드 섹션 -->
        <div class="upload-section">
            <div class="file-upload">
                <div class="upload-box" id="injection-upload">
                    <input type="file" id="injection-file" accept=".xlsx,.xls">
                    <label for="injection-file">
                        📅 사출계획 파일 업로드<br>
                        <small>(예: 06월 5주차 사출계획_250630.xlsx)</small>
                    </label>
                </div>
                
                <div class="upload-box" id="bom-upload">
                    <input type="file" id="bom-file" accept=".xlsx,.xls">
                    <label for="bom-file">
                        🔧 BOM Tree 파일 업로드<br>
                        <small>(예: bom_tree.xlsx)</small>
                    </label>
                </div>
            </div>
            
            <button class="calculate-btn" id="calculate-btn" disabled>
                🧮 약품/잉크 종류 계산하기
            </button>
            
            <!-- 경고 섹션 -->
            <div class="warning-section" id="warning-section">
                <h3>⚠️ BOM에서 찾을 수 없는 제품들</h3>
                <p>다음 제품들은 BOM Tree에 추가해야 합니다:</p>
                <div class="unmatched-list" id="unmatched-list"></div>
            </div>
            
            <!-- 매칭 섹션 -->
            <div class="matching-section" id="matching-section">
                <h3>🔗 제품명 매칭</h3>
                <div class="progress-info" id="progress-info"></div>
                <div id="matching-container"></div>
                <div class="match-controls">
                    <button class="skip-btn" id="skip-all-btn">모두 건너뛰기</button>
                    <button class="confirm-btn" id="save-matches-btn">매칭 저장하고 계속</button>
                </div>
            </div>
        </div>
        
        <!-- 결과 섹션 -->
        <div class="results-section" id="results">
            <!-- 메인 탭 -->
            <div class="main-tabs">
                <button class="main-tab active" data-tab="results">📊 계산 결과</button>
                <button class="main-tab" data-tab="matching">🔧 매칭 관리</button>
            </div>

            <!-- 계산 결과 탭 -->
            <div class="tab-content active" id="results-tab">
                <div class="controls-row">
                    <div class="date-tabs" id="date-tabs"></div>
                    <button class="download-btn" id="download-btn">
                        📥 잉크 목록 엑셀 다운로드
                    </button>
                </div>
                
                <div class="day-summary" id="day-summary">
                    <h3 id="selected-date">날짜를 선택하세요</h3>
                    <div class="summary-stats">
                        <div class="stat-item">
                            <div class="stat-number" id="day-products">0</div>
                            <div class="stat-label">제품 종류</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="day-chemicals">0</div>
                            <div class="stat-label">약품 종류</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="day-inks">0</div>
                            <div class="stat-label">잉크 종류</div>
                        </div>
                    </div>
                </div>
                
                <div class="materials-grid">
                    <div class="material-section">
                        <h3>💊 필요한 약품<span class="multiplier-note">(×3 적용)</span></h3>
                        <div class="material-list" id="chemicals-list"></div>
                    </div>
                    
                    <div class="material-section">
                        <h3>🎨 필요한 잉크<span class="multiplier-note">(×2 적용)</span></h3>
                        <div class="material-list" id="inks-list"></div>
                    </div>
                </div>
                
                <div class="weekly-summary">
                    <h3>📊 주간 전체 요약</h3>
                    <div class="weekly-grid">
                        <div class="weekly-item">
                            <h4>💊 약품 (총 <span id="total-chemicals">0</span>종)</h4>
                            <div class="top-materials" id="weekly-chemicals"></div>
                        </div>
                        <div class="weekly-item">
                            <h4>🎨 잉크 (총 <span id="total-inks">0</span>종)</h4>
                            <div class="top-materials" id="weekly-inks"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 매칭 관리 탭 -->
            <div class="tab-content" id="matching-tab">
                <div class="stats-bar">
                    <div class="stat-badge matched">✅ 매칭됨: <span id="matched-count">0</span>개</div>
                    <div class="stat-badge unmatched">❌ 미매칭: <span id="unmatched-count">0</span>개</div>
                    <button class="edit-btn" id="refresh-matching">🔄 새로고침</button>
                </div>

                <div class="matching-table">
                    <table>
                        <thead>
                            <tr>
                                <th class="product-name-col">사출계획 제품명</th>
                                <th class="matched-product-col">매칭된 BOM 제품</th>
                                <th class="materials-col">약품</th>
                                <th class="materials-col">잉크</th>
                                <th class="action-col">액션</th>
                            </tr>
                        </thead>
                        <tbody id="matching-table-body">
                        </tbody>
                    </table>
                </div>

                <!-- 매칭 편집 섹션 -->
                <div class="search-section" id="search-section" style="display: none;">
                    <h4>🔍 새로운 매칭 찾기: <span id="editing-product"></span></h4>
                    <input type="text" class="search-box" id="bom-search" placeholder="BOM 제품명을 검색하세요...">
                    <div class="search-results" id="search-results"></div>
                    <div style="margin-top: 15px; text-align: center;">
                        <button class="edit-btn" id="cancel-edit">취소</button>
                        <button class="edit-btn" id="clear-matching" style="background: #dc3545; margin-left: 10px;">매칭 해제</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript 모듈들 -->
    <script type="module" src="js/state.js"></script>
    <script type="module" src="js/fileHandler.js"></script>
    <script type="module" src="js/calculator.js"></script>
    <script type="module" src="js/matching.js"></script>
    <script type="module" src="js/ui.js"></script>
    <script type="module" src="js/download.js"></script>
    <script type="module" src="js/app.js"></script>
</body>
</html>